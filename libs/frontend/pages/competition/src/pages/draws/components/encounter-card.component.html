<!-- Encounter Card matching page theme -->
<div class="bg-highlight rounded-border border-1 surface-border mb-4 overflow-hidden">
  <!-- Main encounter display -->
  <div class="p-4 cursor-pointer hover:bg-surface-hover transition-colors transition-duration-150" (click)="toggleExpanded()">
    <!-- Desktop layout -->
    <div class="hidden md:flex items-center justify-content-between gap-4">
      <!-- Home Team -->
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2">
          <span class="font-semibold text-900 white-space-nowrap">{{ encounter().homeTeam?.name || 'TBD' }}</span>
          @if (encounter().homeTeam?.abbreviation) {
            <span class="text-xs text-muted-color white-space-nowrap">({{ encounter().homeTeam?.abbreviation }})</span>
          }
        </div>
      </div>

      <!-- Score -->
      <div class="flex-none">
        @if (encounter().homeScore !== null && encounter().awayScore !== null) {
          <span
            class="inline-flex items-center justify-content-center font-bold px-3 py-2 rounded-border text-surface-900 bg-surface-100 border-1 surface-border"
          >
            {{ encounter().homeScore }} - {{ encounter().awayScore }}
          </span>
        } @else {
          <span class="text-muted-color font-medium px-3 py-2">vs</span>
        }
      </div>

      <!-- Away Team -->
      <div class="flex-1 min-w-0 text-right">
        <div class="flex items-center justify-content-end gap-2">
          <span class="font-semibold text-900 white-space-nowrap">{{ encounter().awayTeam?.name || 'TBD' }}</span>
          @if (encounter().awayTeam?.abbreviation) {
            <span class="text-xs text-muted-color white-space-nowrap">({{ encounter().awayTeam?.abbreviation }})</span>
          }
        </div>
      </div>

      <!-- Date and Expand Arrow -->
      <div class="flex-none">
        <div class="flex items-center gap-3">
          @if (encounter().date) {
            <span class="text-sm text-muted-color white-space-nowrap">{{ encounter().date | date: 'short' }}</span>
          }

          @if (hasGames()) {
            <i class="pi text-muted-color transition-all transition-duration-200" [class]="expanded() ? 'pi-chevron-up' : 'pi-chevron-down'"></i>
          }
        </div>
      </div>
    </div>

    <!-- Mobile layout -->
    <div class="block md:hidden">
      <!-- Teams and Score Row -->
      <div class="flex items-center justify-content-between gap-3 mb-3">
        <!-- Home Team -->
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-900 text-sm truncate">{{ encounter().homeTeam?.name || 'TBD' }}</div>
          @if (encounter().homeTeam?.abbreviation) {
            <div class="text-xs text-muted-color">({{ encounter().homeTeam?.abbreviation }})</div>
          }
        </div>

        <!-- Score -->
        <div class="flex-none">
          @if (encounter().homeScore !== null && encounter().awayScore !== null) {
            <span
              class="inline-flex items-center justify-content-center font-bold px-2 py-1 rounded-border text-surface-900 bg-surface-100 border-1 surface-border text-sm"
            >
              {{ encounter().homeScore }} - {{ encounter().awayScore }}
            </span>
          } @else {
            <span class="text-muted-color font-medium text-sm">vs</span>
          }
        </div>

        <!-- Away Team -->
        <div class="flex-1 min-w-0 text-right">
          <div class="font-semibold text-900 text-sm truncate">{{ encounter().awayTeam?.name || 'TBD' }}</div>
          @if (encounter().awayTeam?.abbreviation) {
            <div class="text-xs text-muted-color">({{ encounter().awayTeam?.abbreviation }})</div>
          }
        </div>
      </div>

      <!-- Date and Expand Row -->
      <div class="flex items-center justify-content-between">
        @if (encounter().date) {
          <span class="text-sm text-muted-color">{{ encounter().date | date: 'short' }}</span>
        }

        @if (hasGames()) {
          <i class="pi text-muted-color transition-all transition-duration-200" [class]="expanded() ? 'pi-chevron-up' : 'pi-chevron-down'"></i>
        }
      </div>
    </div>
  </div>

  <!-- Expanded games section -->
  @if (expanded() && hasGames()) {
    <div class="border-top-1 surface-border px-4 pb-4">
      @if (gamesLoading()) {
        <!-- Loading skeleton for games -->
        <div class="mt-4">
          @for (i of [1, 2, 3]; track i) {
            <div class="flex items-center justify-content-between p-3 mb-2 surface-100 border-round">
              <p-skeleton width="15rem" height="1rem"></p-skeleton>
              <p-skeleton width="8rem" height="1rem"></p-skeleton>
              <p-skeleton width="15rem" height="1rem"></p-skeleton>
            </div>
          }
        </div>
      } @else {
        <div class="mt-4">
          <h5 class="text-sm font-semibold text-600 mb-3 border-bottom-1 surface-border pb-2">
            <i class="pi pi-list mr-2"></i>
            {{ 'all.competition.games' | translate }}
          </h5>

          @if (games().length > 0) {
            <div class="flex flex-col gap-3">
              @for (game of games(); track game.id) {
                <div class="surface-50 p-3 border-round border-1 surface-border">
                  <!-- Game header -->
                  <div class="flex items-center gap-2 mb-3">
                    @if (game.gameType) {
                      <span class="inline-flex items-center px-2 py-1 text-xs font-semibold border-round bg-primary text-white">
                        {{ game.gameType }}
                      </span>
                    }
                    @if (game.order) {
                      <span class="text-sm text-700 font-medium"> {{ 'all.competition.game' | translate }} {{ game.order }} </span>
                    }
                  </div>

                  <!-- Players with scores -->
                  @if (game.gamePlayerMemberships && game.gamePlayerMemberships.length > 0) {
                    <div class="grid grid-cols-1 gap-2">
                      <!-- Team 1 -->
                      <div class="flex items-center gap-3 p-2 surface-0 border-round">
                        <div class="flex items-center gap-2 w-1/3">
                          <div class="flex flex-col gap-1">
                            @for (membership of game.gamePlayerMemberships; track membership.playerId) {
                              @if (membership.team === 1) {
                                <span class="text-sm text-900" [class.underline]="isWinnerTeam(game, 1)" [class.font-bold]="isWinnerTeam(game, 1)">{{
                                  membership.gamePlayer.fullName ||
                                    membership.gamePlayer.firstName + ' ' + membership.gamePlayer.lastName ||
                                    'Unknown'
                                }}</span>
                              }
                            }
                          </div>
                        </div>
                        <!-- Team 1 Scores -->
                        @if (hasSetScores(game)) {
                          <div class="flex items-center gap-2">
                            @if (game.set1Team1 !== null) {
                              <span class="text-xs text-900" [class.font-bold]="isWinnerTeam(game, 1)">
                                {{ game.set1Team1 }}
                              </span>
                            }
                            @if (game.set2Team1 !== null) {
                              <span class="text-xs text-900" [class.font-bold]="isWinnerTeam(game, 1)">
                                {{ game.set2Team1 }}
                              </span>
                            }
                            @if (game.set3Team1 !== null) {
                              <span class="text-xs text-900" [class.font-bold]="isWinnerTeam(game, 1)">
                                {{ game.set3Team1 }}
                              </span>
                            }
                          </div>
                        }
                      </div>

                      <!-- Team 2 -->
                      <div class="flex items-center gap-3 p-2 surface-0 border-round">
                        <div class="flex items-center gap-2 w-1/3">
                          <div class="flex flex-col gap-1">
                            @for (membership of game.gamePlayerMemberships; track membership.playerId) {
                              @if (membership.team === 2) {
                                <span class="text-sm text-900" [class.underline]="isWinnerTeam(game, 2)" [class.font-bold]="isWinnerTeam(game, 2)">{{
                                  membership.gamePlayer.fullName ||
                                    membership.gamePlayer.firstName + ' ' + membership.gamePlayer.lastName ||
                                    'Unknown'
                                }}</span>
                              }
                            }
                          </div>
                        </div>
                        <!-- Team 2 Scores -->
                        @if (hasSetScores(game)) {
                          <div class="flex items-center gap-2">
                            @if (game.set1Team2 !== null) {
                              <span class="text-xs text-900" [class.font-bold]="isWinnerTeam(game, 2)">
                                {{ game.set1Team2 }}
                              </span>
                            }
                            @if (game.set2Team2 !== null) {
                              <span class="text-xs text-900" [class.font-bold]="isWinnerTeam(game, 2)">
                                {{ game.set2Team2 }}
                              </span>
                            }
                            @if (game.set3Team2 !== null) {
                              <span class="text-xs text-900" [class.font-bold]="isWinnerTeam(game, 2)">
                                {{ game.set3Team2 }}
                              </span>
                            }
                          </div>
                        }
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          } @else {
            <div class="text-center py-4 text-600">
              <i class="pi pi-info-circle text-2xl mb-2 block text-400"></i>
              <span class="text-sm">{{ 'all.competition.no_games' | translate }}</span>
            </div>
          }
        </div>
      }
    </div>
  }
</div>
