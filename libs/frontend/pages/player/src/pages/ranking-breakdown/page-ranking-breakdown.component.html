@if (systemLoaded() && system()) {
  <!-- Page Header Section -->
  <section class="mb-6">
    <div class="rounded-border border border-surface overflow-hidden">
      <!-- Header with title and controls -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 px-4 py-4 bg-highlight">
        <div class="flex items-center gap-3">
          <p-button icon="pi pi-arrow-left" severity="secondary" [text]="true" [rounded]="true" (click)="goBack()" />
          <i class="pi pi-chart-bar text-2xl text-primary"></i>
          <div>
            <h2 class="text-xl font-semibold text-color m-0">{{ 'all.ranking.breakdown.pointsPerGame' | translate }}</h2>
            <p class="text-sm text-muted-color m-0 mt-1">{{ system().name }}</p>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
          <p-select
            [options]="gameTypeOptions"
            [ngModel]="gameTypeControl.value"
            (onChange)="onGameTypeChange($event.value)"
            optionLabel="label"
            optionValue="value"
            placeholder="{{ 'all.game.types.title' | translate }}"
            class="w-full sm:w-auto"
          />

          <app-period-selection [system]="system()" />
        </div>
      </div>
    </div>
  </section>

  <!-- Filters & View Toggles -->
  <section class="mb-6">
    <div class="rounded-border border border-surface overflow-hidden">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 px-4 py-3 bg-highlight">
        <!-- Filter Toggles -->
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-sm font-medium text-muted-color mr-2">
            <i class="pi pi-filter text-xs mr-1"></i>
            {{ 'all.ranking.breakdown.filters' | translate }}:
          </span>
          <p-togglebutton
            [(ngModel)]="filter.controls.includedUpgrade.value"
            onLabel="{{ 'all.ranking.breakdown.usedForUpgrade' | translate }}"
            offLabel="{{ 'all.ranking.breakdown.usedForUpgrade' | translate }}"
            (onChange)="filter.controls.includedUpgrade.setValue($event.checked)"
          />
          <p-togglebutton
            [(ngModel)]="filter.controls.includedDowngrade.value"
            onLabel="{{ 'all.ranking.breakdown.usedForDowngrade' | translate }}"
            offLabel="{{ 'all.ranking.breakdown.usedForDowngrade' | translate }}"
            (onChange)="filter.controls.includedDowngrade.setValue($event.checked)"
          />
          @if ((system().latestXGamesToUse ?? 0) > 0) {
            <p-togglebutton
              [(ngModel)]="filter.controls.includedIgnored.value"
              onLabel="{{ 'all.ranking.breakdown.notUsed' | translate }}"
              offLabel="{{ 'all.ranking.breakdown.notUsed' | translate }}"
              (onChange)="filter.controls.includedIgnored.setValue($event.checked)"
            />
            <p-togglebutton
              [(ngModel)]="filter.controls.includeOutOfScopeLatestX.value"
              onLabel="{{ 'all.ranking.breakdown.outOfScopeLatestX' | translate: { latestX: system().latestXGamesToUse } }}"
              offLabel="{{ 'all.ranking.breakdown.outOfScopeLatestX' | translate: { latestX: system().latestXGamesToUse } }}"
              (onChange)="filter.controls.includeOutOfScopeLatestX.setValue($event.checked)"
            />
          }
        </div>

        <!-- View Toggles -->
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-sm font-medium text-muted-color mr-2">
            <i class="pi pi-eye text-xs mr-1"></i>
            {{ 'all.ranking.breakdown.show' | translate }}:
          </span>
          <p-togglebutton
            [ngModel]="breakdownService.showUpgrade()"
            onLabel="{{ 'all.ranking.breakdown.show-upgrade' | translate }}"
            offLabel="{{ 'all.ranking.breakdown.show-upgrade' | translate }}"
            (onChange)="breakdownService.showUpgrade.set($event.checked)"
          />
          <p-togglebutton
            [ngModel]="breakdownService.showDowngrade()"
            onLabel="{{ 'all.ranking.breakdown.show-downgrade' | translate }}"
            offLabel="{{ 'all.ranking.breakdown.show-downgrade' | translate }}"
            (onChange)="breakdownService.showDowngrade.set($event.checked)"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Games List Section -->
  <section>
    <div class="rounded-border border border-surface overflow-hidden">
      <app-list-games [system]="system()" [player]="{ id: playerId() }" [rankingPlace]="rankingPlace()" [type]="type()" />
    </div>
  </section>
} @else {
  <!-- Loading State -->
  <div class="rounded-border border border-surface overflow-hidden">
    <div class="flex items-center gap-3 px-4 py-4 bg-highlight">
      <p-skeleton width="2rem" height="2rem" borderRadius="0.5rem" />
      <div class="flex-1">
        <p-skeleton width="12rem" height="1.5rem" styleClass="mb-2" />
        <p-skeleton width="8rem" height="1rem" />
      </div>
    </div>
    <div class="p-4">
      <p-progressBar mode="indeterminate" [style]="{ height: '4px' }" />
    </div>
  </div>
}
