@if (!loading()) {
  @if (this.player(); as player) {
    <app-page-header>
      <ng-content title>{{ 'player.edit.claims.title' | translate }} - {{ player.fullName }}</ng-content>
      <ng-content subTitle>
        <div class="info">
          <div class="sub-text">{{ 'player.edit.claims.subtitle' | translate }}</div>
        </div>
      </ng-content>
    </app-page-header>

    <div class="p-4">
      <p class="text-surface-500 mb-6">
        {{ 'player.edit.claims.description' | translate }}
      </p>

      <form [formGroup]="claimsForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Actions Header -->
        @if (globalClaims().length > 0) {
          <div class="flex flex-col sm:flex-row justify-between gap-4 pb-6 border-b border-surface-border">
            <div class="flex gap-2">
              <p-button [label]="'player.edit.claims.actions.select-all' | translate" [outlined]="true" size="small" type="button" (click)="selectAll()"> </p-button>
              <p-button [label]="'player.edit.claims.actions.select-none' | translate" [outlined]="true" size="small" type="button" (click)="selectNone()"> </p-button>
            </div>
            <div class="flex gap-3">
              <p-button [label]="'player.edit.claims.actions.save' | translate" icon="pi pi-save" type="submit" [loading]="saving()" [disabled]="saving() || globalClaims().length === 0">
              </p-button>
              <p-button [label]="'player.edit.claims.actions.cancel' | translate" icon="pi pi-times" [outlined]="true" type="button" (click)="cancel()" [disabled]="saving()"> </p-button>
            </div>
          </div>
        }
        <!-- Claims Selection -->
        <div class="space-y-6">
          @if (globalClaims().length === 0) {
            <p class="text-surface-500">{{ 'player.edit.claims.messages.no-claims' | translate }}</p>
          } @else {
            @for (categoryGroup of claimsByCategory(); track categoryGroup.category) {
              <p-card>
                <ng-template #title>
                  <div class="flex items-center justify-between w-full">
                    <span class="text-lg font-medium">{{ categoryGroup.category }}</span>
                    <div class="flex gap-2">
                      <p-button [label]="'player.edit.claims.actions.select-all' | translate" [outlined]="true" size="small" type="button" (click)="selectAllInCategory(categoryGroup.category)">
                      </p-button>
                      <p-button
                        [label]="'player.edit.claims.actions.select-none' | translate"
                        [outlined]="true"
                        size="small"
                        type="button"
                        (click)="selectNoneInCategory(categoryGroup.category)"
                      >
                      </p-button>
                    </div>
                  </div>
                </ng-template>

                <!-- Claims Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                  @for (claim of categoryGroup.claims; track claim.id) {
                    <div class="flex items-start space-x-3 p-3 border border-surface-border rounded-md transition-colors hover:bg-surface-hover">
                      <p-checkbox [formControlName]="claim.id!" [inputId]="claim.id!" [binary]="true"> </p-checkbox>
                      <div class="flex-1 min-w-0">
                        <label [for]="claim.id!" class="font-medium cursor-pointer block leading-tight">
                          {{ claim.name }}
                        </label>
                        @if (claim.description) {
                          <p class="text-xs text-surface-500 mt-1 mb-0 leading-tight">{{ claim.description }}</p>
                        }
                      </div>
                    </div>
                  }
                </div>
              </p-card>
            }
          }
        </div>

        <!-- Loading Indicator -->
        @if (saving()) {
          <div class="pt-4">
            <p-progressbar mode="indeterminate" [style]="{ height: '6px' }" />
            <p class="text-sm text-surface-500 mt-2">{{ 'player.edit.claims.messages.saving' | translate }}</p>
          </div>
        }

        <!-- Error Message -->
        @if (error(); as errorMessage) {
          <p-message severity="error" [text]="errorMessage"></p-message>
        }
      </form>
    </div>
  }
} @else {
  <div class="p-4">
    <p-progressBar mode="indeterminate" [style]="{ height: '6px' }" />
    <p class="text-center text-surface-500 mt-4">{{ 'player.edit.claims.messages.loading' | translate }}</p>
  </div>
}

@if (error(); as errorMessage) {
  <div class="flex items-center justify-center p-8 text-red-600">
    <i class="pi pi-exclamation-triangle mr-2"></i>
    <span>{{ errorMessage }}</span>
  </div>
}

<!-- Toast Messages -->
<p-toast position="top-right"></p-toast>
