@if (isBrowser()) {
  <p-table
    [value]="dataSource()"
    [loading]="loading()"
    [sortField]="'winRate'"
    [sortOrder]="-1"
    styleClass="p-datatable-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        @for (col of columns; track col) {
          <th [pSortableColumn]="col.field">
            {{ col.header | async }}
            <p-sortIcon [field]="col.field"></p-sortIcon>
          </th>
        }
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData>
      <tr>
        @for (col of columns; track col) {
          <td>
            @switch (col.field) {
              @case ('player.fullName') {
                <span>{{ rowData.player?.fullName }}</span>
              }
              @case ('club.name') {
                <span>{{ rowData.club?.name || '-' }}</span>
              }
              @case ('winRate') {
                {{ rowData[col.field] | number: '1.0-2' }} %
              }
              @default {
                <span>{{ rowData[col.field] }}</span>
              }
            }
          </td>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="footer">
      <tr>
        @for (col of columns; track col) {
          <td class="font-bold text-right">
            @switch (col.field) {
              @case ('winRate') {
                {{ 'all.partner.grid.average' | translate }}: {{ averageWinRate | number: '1.0-2' }} %
              }
              @case ('amountOfGames') {
                {{ 'all.partner.grid.total' | translate }}: {{ totalGames }}
              }
              @default {
                <!-- empty for alignment -->
              }
            }
          </td>
        }
      </tr>
    </ng-template>
  </p-table>
} @else {
  <!-- SSR fallback -->
  <div class="p-4 text-center">
    <i class="pi pi-spin pi-spinner text-2xl"></i>
    <p class="mt-2">{{ 'all.partner.grid.loading' | translate }}</p>
  </div>
}
