<div class="flex flex-col gap-6">
  <!-- Stats Cards -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <!-- Total Entries -->
    <div class="bg-white dark:bg-surface-900 rounded-border border border-surface-200 dark:border-surface-700 p-4 flex flex-col items-center justify-center text-center transition-all hover:shadow-md hover:border-surface-300 dark:hover:border-surface-600">
      <div class="w-12 h-12 rounded-full bg-surface-100 dark:bg-surface-800 flex items-center justify-center mb-3">
        <i class="pi pi-users text-xl text-surface-700 dark:text-surface-300"></i>
      </div>
      <div class="text-3xl font-bold text-surface-900 dark:text-surface-0 tracking-tight">{{ stats().total }}</div>
      <div class="text-xs font-medium text-surface-500 dark:text-surface-400 uppercase tracking-wider mt-1">
        {{ 'all.tournament.admin.draws.totalEntries' | translate }}
      </div>
      <div class="text-xs text-surface-400 dark:text-surface-500 mt-0.5">
        {{ 'all.tournament.admin.draws.totalEntriesDescription' | translate }}
      </div>
    </div>

    <!-- Assigned -->
    <div class="bg-white dark:bg-surface-900 rounded-border border border-green-200 dark:border-green-900/50 p-4 flex flex-col items-center justify-center text-center transition-all hover:shadow-md hover:border-green-300 dark:hover:border-green-800">
      <div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mb-3">
        <i class="pi pi-check text-xl text-green-600 dark:text-green-400"></i>
      </div>
      <div class="text-3xl font-bold text-green-600 dark:text-green-400 tracking-tight">{{ stats().assigned }}</div>
      <div class="text-xs font-medium text-surface-500 dark:text-surface-400 uppercase tracking-wider mt-1">
        {{ 'all.tournament.admin.draws.assigned' | translate }}
      </div>
      <div class="text-xs text-surface-400 dark:text-surface-500 mt-0.5">
        {{ 'all.tournament.admin.draws.assignedDescription' | translate }}
      </div>
    </div>

    <!-- Unassigned -->
    <div class="bg-white dark:bg-surface-900 rounded-border border border-orange-200 dark:border-orange-900/50 p-4 flex flex-col items-center justify-center text-center transition-all hover:shadow-md hover:border-orange-300 dark:hover:border-orange-800">
      <div class="w-12 h-12 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center mb-3">
        <i class="pi pi-clock text-xl text-orange-600 dark:text-orange-400"></i>
      </div>
      <div class="text-3xl font-bold text-orange-600 dark:text-orange-400 tracking-tight">{{ stats().unassigned }}</div>
      <div class="text-xs font-medium text-surface-500 dark:text-surface-400 uppercase tracking-wider mt-1">
        {{ 'all.tournament.admin.draws.unassigned' | translate }}
      </div>
      <div class="text-xs text-surface-400 dark:text-surface-500 mt-0.5">
        {{ 'all.tournament.admin.draws.unassignedDescription' | translate }}
      </div>
    </div>

    <!-- Draw Count -->
    <div class="bg-white dark:bg-surface-900 rounded-border border border-blue-200 dark:border-blue-900/50 p-4 flex flex-col items-center justify-center text-center transition-all hover:shadow-md hover:border-blue-300 dark:hover:border-blue-800">
      <div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mb-3">
        <i class="pi pi-sitemap text-xl text-blue-600 dark:text-blue-400"></i>
      </div>
      <div class="text-3xl font-bold text-blue-600 dark:text-blue-400 tracking-tight">{{ stats().draws }}</div>
      <div class="text-xs font-medium text-surface-500 dark:text-surface-400 uppercase tracking-wider mt-1">
        {{ 'all.tournament.admin.draws.drawCount' | translate }}
      </div>
      <div class="text-xs text-surface-400 dark:text-surface-500 mt-0.5">
        {{ 'all.tournament.admin.draws.drawCountDescription' | translate }}
      </div>
    </div>
  </div>

  <!-- Actions Bar -->
  <div class="bg-white dark:bg-surface-900 rounded-border border border-surface-200 dark:border-surface-700 p-5">
    <div class="flex flex-wrap gap-4 items-end">
      <div class="flex flex-col gap-2 flex-1 min-w-56">
        <label for="subEvent" class="text-sm font-medium text-color">
          {{ 'all.tournament.admin.draws.subEvent' | translate }}
        </label>
        <p-select
          id="subEvent"
          [formControl]="subEventControl"
          [options]="subEvents()"
          optionLabel="name"
          [placeholder]="'all.tournament.admin.draws.selectSubEvent' | translate"
          styleClass="w-full"
        />
      </div>

      <div class="flex gap-2 flex-wrap">
        <p-button
          icon="pi pi-cog"
          [label]="'all.tournament.admin.draws.generateEntries' | translate"
          severity="secondary"
          [outlined]="true"
          (click)="generateEntries()"
          [loading]="updating()"
          [disabled]="!selectedSubEvent()"
        />

        <p-button
          icon="pi pi-plus"
          [label]="'all.tournament.admin.draws.createDraw' | translate"
          (click)="openCreateDrawDialog()"
          [disabled]="!selectedSubEvent()"
        />

        <p-button
          icon="pi pi-refresh"
          severity="secondary"
          [outlined]="true"
          pTooltip="Refresh"
          tooltipPosition="top"
          (click)="refetch()"
          [loading]="loading()"
        />
      </div>
    </div>
  </div>

  @if (updateError()) {
    <p-message severity="error" [text]="updateError()!" styleClass="w-full" />
  }

  @if (loading()) {
    <div class="h-1 w-full overflow-hidden rounded-full bg-surface-200 dark:bg-surface-700">
      <div class="h-full bg-primary animate-pulse" style="width: 100%"></div>
    </div>
  }

  @if (selectedSubEvent()) {
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Unassigned Entries Panel -->
      <div class="bg-surface-0 dark:bg-surface-900 rounded-border border border-surface-200 dark:border-surface-700 overflow-hidden">
        <!-- Header -->
        <div class="px-5 py-4 border-b border-surface-200 dark:border-surface-700 bg-surface-50 dark:bg-surface-800">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-9 h-9 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
                <i class="pi pi-inbox text-orange-600 dark:text-orange-400"></i>
              </div>
              <div>
                <h4 class="text-base font-semibold text-color m-0">
                  {{ 'all.tournament.admin.draws.unassignedEntries' | translate }}
                </h4>
                <p class="text-xs text-muted-color m-0">{{ unassignedEntries().length }} entries</p>
              </div>
            </div>
            <div class="flex gap-1">
              <p-button
                size="small"
                [text]="true"
                icon="pi pi-check-square"
                pTooltip="Select all"
                tooltipPosition="top"
                (click)="selectAllUnassigned()"
                [disabled]="unassignedEntries().length === 0"
              />
              <p-button
                size="small"
                [text]="true"
                icon="pi pi-times"
                pTooltip="Clear selection"
                tooltipPosition="top"
                (click)="clearSelection()"
                [disabled]="selectedEntries().length === 0"
              />
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="p-0">
          @if (unassignedEntries().length > 0) {
            <div class="max-h-80 overflow-y-auto">
              @for (entry of unassignedEntries(); track entry.id) {
                <div
                  class="flex items-center gap-3 px-5 py-3 border-b border-surface-100 dark:border-surface-800 cursor-pointer transition-colors"
                  [class.bg-primary-50]="isEntrySelected(entry)"
                  [class.dark:bg-primary-900/20]="isEntrySelected(entry)"
                  [class.hover:bg-surface-50]="!isEntrySelected(entry)"
                  [class.dark:hover:bg-surface-800]="!isEntrySelected(entry)"
                  (click)="toggleEntrySelection(entry)"
                >
                  <p-checkbox [binary]="true" [ngModel]="isEntrySelected(entry)" />
                  <div class="w-8 h-8 rounded-full bg-surface-200 dark:bg-surface-700 flex items-center justify-center flex-shrink-0">
                    <i class="pi pi-user text-muted-color text-xs"></i>
                  </div>
                  <span class="text-sm font-medium text-color">{{ getEntryName(entry) }}</span>
                </div>
              }
            </div>

            <!-- Assignment Controls -->
            @if (selectedEntries().length > 0) {
              <div class="px-5 py-4 bg-surface-50 dark:bg-surface-800 border-t border-surface-200 dark:border-surface-700">
                <div class="flex flex-wrap gap-3 items-center">
                  <span class="text-sm font-medium text-color bg-primary/10 px-3 py-1 rounded-full">
                    {{ selectedEntries().length }} selected
                  </span>
                  <p-select
                    [options]="draws()"
                    optionLabel="name"
                    optionValue="id"
                    [placeholder]="'all.tournament.admin.draws.selectDraw' | translate"
                    (onChange)="targetDrawId.set($event.value)"
                    styleClass="flex-1 min-w-40"
                  />
                  <p-button
                    icon="pi pi-arrow-right"
                    [label]="'all.tournament.admin.draws.assign' | translate"
                    size="small"
                    (click)="assignSelectedToDraw()"
                    [disabled]="!targetDrawId()"
                    [loading]="updating()"
                  />
                </div>
              </div>
            }
          } @else {
            <div class="flex flex-col items-center justify-center py-12 text-center">
              <div class="w-14 h-14 rounded-full bg-surface-100 dark:bg-surface-700 flex items-center justify-center mb-4">
                <i class="pi pi-check-circle text-2xl text-green-500"></i>
              </div>
              <p class="text-muted-color text-sm">
                @if (entries().length > 0) {
                  {{ 'all.tournament.admin.draws.allEntriesAssigned' | translate }}
                } @else {
                  {{ 'all.tournament.admin.draws.noEntriesYet' | translate }}
                }
              </p>
            </div>
          }
        </div>
      </div>

      <!-- Draws Panel -->
      <div class="flex flex-col gap-4">
        @for (draw of draws(); track draw.id) {
          <div class="bg-surface-0 dark:bg-surface-900 rounded-border border border-surface-200 dark:border-surface-700 overflow-hidden">
            <!-- Draw Header -->
            <div class="px-5 py-4 border-b border-surface-200 dark:border-surface-700 bg-surface-50 dark:bg-surface-800">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center">
                    <i class="pi pi-sitemap text-primary"></i>
                  </div>
                  <div>
                    <div class="flex items-center gap-2">
                      <h4 class="text-base font-semibold text-color m-0">{{ draw.name }}</h4>
                      <p-tag
                        [value]="draw.type ?? 'N/A'"
                        [severity]="getDrawTypeSeverity(draw.type)"
                        [rounded]="true"
                        styleClass="text-xs"
                      />
                    </div>
                    <p class="text-xs text-muted-color m-0">
                      {{ draw.entries?.length ?? 0 }} / {{ draw.size ?? '∞' }} entries
                    </p>
                  </div>
                </div>
                <div class="flex gap-1">
                  <p-button
                    size="small"
                    [text]="true"
                    icon="pi pi-sort-numeric-up"
                    pTooltip="Auto-seed"
                    tooltipPosition="top"
                    (click)="openSeedingDialog(draw)"
                    [disabled]="!draw.entries?.length"
                  />
                  <p-button
                    size="small"
                    [text]="true"
                    icon="pi pi-eraser"
                    pTooltip="Clear seeds"
                    tooltipPosition="top"
                    (click)="clearSeeds(draw)"
                    [disabled]="!draw.entries?.length"
                  />
                  <p-button
                    size="small"
                    [text]="true"
                    severity="danger"
                    icon="pi pi-trash"
                    pTooltip="Delete draw"
                    tooltipPosition="top"
                    (click)="deleteDraw(draw)"
                  />
                </div>
              </div>
            </div>

            <!-- Draw Entries -->
            <div class="p-0">
              @if (draw.entries?.length) {
                <div class="max-h-56 overflow-y-auto">
                  @for (entry of draw.entries; track entry.id) {
                    <div class="flex items-center gap-3 px-5 py-3 border-b border-surface-100 dark:border-surface-800 last:border-b-0 hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                      <!-- Seed Badge -->
                      <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"
                           [class.bg-primary]="entry.seed"
                           [class.text-primary-contrast]="entry.seed"
                           [class.bg-surface-100]="!entry.seed"
                           [class.dark:bg-surface-700]="!entry.seed">
                        @if (entry.seed) {
                          <span class="text-xs font-bold">{{ entry.seed }}</span>
                        } @else {
                          <span class="text-xs text-muted-color">—</span>
                        }
                      </div>
                      <span class="text-sm font-medium text-color flex-1">{{ getEntryName(entry) }}</span>
                      <p-button
                        size="small"
                        [text]="true"
                        severity="danger"
                        icon="pi pi-minus"
                        pTooltip="Remove from draw"
                        tooltipPosition="top"
                        (click)="removeFromDraw(entry)"
                        [loading]="updating()"
                      />
                    </div>
                  }
                </div>
              } @else {
                <div class="flex flex-col items-center justify-center py-8 text-center">
                  <div class="w-12 h-12 rounded-full bg-surface-100 dark:bg-surface-700 flex items-center justify-center mb-3">
                    <i class="pi pi-inbox text-xl text-muted-color"></i>
                  </div>
                  <p class="text-sm text-muted-color">No entries assigned yet</p>
                </div>
              }
            </div>
          </div>
        } @empty {
          <div class="bg-surface-0 dark:bg-surface-900 rounded-border border border-surface-200 dark:border-surface-700 p-12 text-center">
            <div class="w-16 h-16 rounded-full bg-surface-100 dark:bg-surface-700 flex items-center justify-center mb-4 mx-auto">
              <i class="pi pi-sitemap text-2xl text-muted-color"></i>
            </div>
            <p class="text-muted-color mb-4">{{ 'all.tournament.admin.draws.noDrawsYet' | translate }}</p>
            <p-button
              [label]="'all.tournament.admin.draws.createDraw' | translate"
              icon="pi pi-plus"
              size="small"
              [outlined]="true"
              (click)="openCreateDrawDialog()"
            />
          </div>
        }
      </div>
    </div>
  } @else {
    <div class="bg-surface-0 dark:bg-surface-900 rounded-border border border-surface-200 dark:border-surface-700 p-12 text-center">
      <div class="w-16 h-16 rounded-full bg-surface-100 dark:bg-surface-700 flex items-center justify-center mb-4 mx-auto">
        <i class="pi pi-arrow-up text-2xl text-muted-color"></i>
      </div>
      <p class="text-muted-color text-lg">{{ 'all.tournament.admin.draws.selectSubEventFirst' | translate }}</p>
    </div>
  }

  <!-- Create Draw Dialog -->
  <p-dialog
    [header]="'all.tournament.admin.draws.createDraw' | translate"
    [(visible)]="showCreateDrawDialog"
    [modal]="true"
    [style]="{ width: '500px' }"
    [draggable]="false"
    [resizable]="false"
  >
    <div class="flex flex-col gap-5">
      <div class="flex flex-col gap-2">
        <label for="drawName" class="text-sm font-medium text-color">
          {{ 'all.tournament.admin.draws.drawName' | translate }}
          <span class="text-red-500">*</span>
        </label>
        <input pInputText id="drawName" [formControl]="drawForm.controls.name" class="w-full" />
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="flex flex-col gap-2">
          <label for="drawType" class="text-sm font-medium text-color">
            {{ 'all.tournament.admin.draws.drawType' | translate }}
            <span class="text-red-500">*</span>
          </label>
          <p-select
            id="drawType"
            [formControl]="drawForm.controls.type"
            [options]="drawTypeOptions"
            optionLabel="label"
            optionValue="value"
            styleClass="w-full"
          />
        </div>

        <div class="flex flex-col gap-2">
          <label for="subEventType" class="text-sm font-medium text-color">
            {{ 'all.tournament.admin.draws.subEventType' | translate }}
            <span class="text-red-500">*</span>
          </label>
          <p-select
            id="subEventType"
            [formControl]="drawForm.controls.subEventType"
            [options]="subEventTypeOptions"
            optionLabel="label"
            optionValue="value"
            styleClass="w-full"
          />
        </div>
      </div>

      <div class="flex flex-col gap-2">
        <label for="drawSize" class="text-sm font-medium text-color">
          {{ 'all.tournament.admin.draws.drawSize' | translate }}
        </label>
        <p-select
          id="drawSize"
          [formControl]="drawForm.controls.size"
          [options]="drawSizeOptions"
          optionLabel="label"
          optionValue="value"
          [placeholder]="'all.tournament.admin.draws.selectSize' | translate"
          [showClear]="true"
          styleClass="w-full"
        />
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="flex flex-col gap-2">
          <label for="minLevel" class="text-sm font-medium text-color">
            {{ 'all.tournament.admin.draws.minLevel' | translate }}
          </label>
          <p-inputNumber
            id="minLevel"
            [formControl]="drawForm.controls.minLevel"
            [min]="1"
            [max]="12"
            [showButtons]="true"
            styleClass="w-full"
            [placeholder]="'all.tournament.admin.draws.minLevelPlaceholder' | translate"
          />
          <small class="text-surface-400 dark:text-surface-500 text-xs">
            {{ 'all.tournament.admin.draws.minLevelHelp' | translate }}
          </small>
        </div>

        <div class="flex flex-col gap-2">
          <label for="maxLevel" class="text-sm font-medium text-color">
            {{ 'all.tournament.admin.draws.maxLevel' | translate }}
          </label>
          <p-inputNumber
            id="maxLevel"
            [formControl]="drawForm.controls.maxLevel"
            [min]="1"
            [max]="12"
            [showButtons]="true"
            styleClass="w-full"
            [placeholder]="'all.tournament.admin.draws.maxLevelPlaceholder' | translate"
          />
          <small class="text-surface-400 dark:text-surface-500 text-xs">
            {{ 'all.tournament.admin.draws.maxLevelHelp' | translate }}
          </small>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex gap-3 justify-end">
        <p-button
          [label]="'all.button.cancel' | translate"
          severity="secondary"
          [outlined]="true"
          (click)="showCreateDrawDialog.set(false)"
        />
        <p-button
          [label]="'all.button.create' | translate"
          icon="pi pi-plus"
          (click)="createDraw()"
          [disabled]="!drawForm.valid"
          [loading]="updating()"
        />
      </div>
    </ng-template>
  </p-dialog>

  <!-- Seeding Dialog -->
  <p-dialog
    [header]="'all.tournament.admin.draws.seedingOptions' | translate"
    [(visible)]="showSeedingDialog"
    [modal]="true"
    [style]="{ width: '400px' }"
    [draggable]="false"
    [resizable]="false"
  >
    <div class="flex flex-col gap-5">
      <p class="text-sm text-muted-color m-0">
        {{ 'all.tournament.admin.draws.seedingDescription' | translate }}
      </p>

      <div class="flex flex-col gap-2">
        <label for="seedingMethod" class="text-sm font-medium text-color">
          {{ 'all.tournament.admin.draws.seedingMethod' | translate }}
        </label>
        <p-select
          id="seedingMethod"
          [formControl]="seedingMethod"
          [options]="seedingMethodOptions"
          optionLabel="label"
          optionValue="value"
          styleClass="w-full"
        />
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex gap-3 justify-end">
        <p-button
          [label]="'all.button.cancel' | translate"
          severity="secondary"
          [outlined]="true"
          (click)="showSeedingDialog.set(false)"
        />
        <p-button
          [label]="'all.tournament.admin.draws.applySeeding' | translate"
          icon="pi pi-check"
          (click)="applySeeding()"
          [loading]="updating()"
        />
      </div>
    </ng-template>
  </p-dialog>
</div>
